---
import Layout from '../../layouts/Layout.astro';
import Nav from '../../components/Nav.astro';
---

<Layout title="Personalization Engine">
  <Nav />
  
  <div class="main-content">
    <div class="container">
      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Audience</div>
          </div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Segments</div>
          </div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Content</div>
          </div>
          <div class="progress-step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-label">Deploy</div>
          </div>
        </div>
      </div>

      <!-- Step 1: Audience Analysis -->
      <div class="step-content" id="step1">
        <div class="step-header">
          <h2>Audience Analysis</h2>
          <p>Analyze your audience data to create personalized experiences</p>
        </div>

        <div class="form-section">
          <div class="input-group">
            <label>Data Sources</label>
            <div class="data-sources-grid">
              <div class="data-source-card">
                <div class="source-icon">ðŸ“Š</div>
                <h4>Google Analytics</h4>
                <input type="text" placeholder="Property ID" class="source-input">
                <button class="cn-bt">Connect</button>
              </div>
              <div class="data-source-card">
                <div class="source-icon">ðŸ‘¥</div>
                <h4>CRM Data</h4>
                <input type="file" accept=".csv,.json" class="source-input">
                <button class="cn-bt">Upload</button>
              </div>
              <div class="data-source-card">
                <div class="source-icon">ðŸ“±</div>
                <h4>Social Media</h4>
                <select class="source-input">
                  <option>Facebook</option>
                  <option>Instagram</option>
                  <option>Twitter</option>
                </select>
                <button class="cn-bt">Connect</button>
              </div>
              <div class="data-source-card">
                <div class="source-icon">ðŸ“§</div>
                <h4>Email Platform</h4>
                <select class="source-input">
                  <option>Mailchimp</option>
                  <option>ConvertKit</option>
                  <option>ActiveCampaign</option>
                </select>
                <button class="cn-bt">Connect</button>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label>Analysis Parameters</label>
            <div class="parameters-grid">
              <div class="parameter-item">
                <input type="checkbox" id="demographics" checked>
                <label for="demographics">Demographics</label>
              </div>
              <div class="parameter-item">
                <input type="checkbox" id="behavior" checked>
                <label for="behavior">Behavior Patterns</label>
              </div>
              <div class="parameter-item">
                <input type="checkbox" id="interests" checked>
                <label for="interests">Interests & Preferences</label>
              </div>
              <div class="parameter-item">
                <input type="checkbox" id="journey" checked>
                <label for="journey">Customer Journey</label>
              </div>
              <div class="parameter-item">
                <input type="checkbox" id="engagement" checked>
                <label for="engagement">Engagement History</label>
              </div>
              <div class="parameter-item">
                <input type="checkbox" id="conversion" checked>
                <label for="conversion">Conversion Patterns</label>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-primary" id="analyzeAudience">Analyze Audience</button>
        </div>
      </div>

      <!-- Step 2: Audience Segments -->
      <div class="step-content" id="step2" style="display: none;">
        <div class="step-header">
          <h2>Audience Segments</h2>
          <p>Review and customize your audience segments</p>
        </div>

        <div class="segments-container">
          <div class="segments-overview">
            <div class="segment-stats">
              <div class="stat-card">
                <h3>12,450</h3>
                <p>Total Audience</p>
              </div>
              <div class="stat-card">
                <h3>5</h3>
                <p>Segments Created</p>
              </div>
              <div class="stat-card">
                <h3>87%</h3>
                <p>Coverage Rate</p>
              </div>
            </div>
          </div>

          <div class="segments-list">
            <div class="segment-card">
              <div class="segment-header">
                <h4>High-Value Customers</h4>
                <span class="segment-size">2,340 users (18.8%)</span>
              </div>
              <div class="segment-details">
                <p><strong>Characteristics:</strong> High purchase frequency, premium product preference, high engagement</p>
                <p><strong>Behavior:</strong> Regular buyers, brand advocates, social sharers</p>
                <div class="segment-actions">
                  <button class="btn-secondary">Edit Segment</button>
                  <button class="btn-secondary">View Details</button>
                </div>
              </div>
            </div>

            <div class="segment-card">
              <div class="segment-header">
                <h4>Price-Conscious Shoppers</h4>
                <span class="segment-size">3,890 users (31.2%)</span>
              </div>
              <div class="segment-details">
                <p><strong>Characteristics:</strong> Deal seekers, comparison shoppers, budget-focused</p>
                <p><strong>Behavior:</strong> Responds to discounts, long consideration period</p>
                <div class="segment-actions">
                  <button class="btn-secondary">Edit Segment</button>
                  <button class="btn-secondary">View Details</button>
                </div>
              </div>
            </div>

            <div class="segment-card">
              <div class="segment-header">
                <h4>New Visitors</h4>
                <span class="segment-size">4,120 users (33.1%)</span>
              </div>
              <div class="segment-details">
                <p><strong>Characteristics:</strong> First-time visitors, exploring products, information seekers</p>
                <p><strong>Behavior:</strong> High bounce rate, needs nurturing, potential customers</p>
                <div class="segment-actions">
                  <button class="btn-secondary">Edit Segment</button>
                  <button class="btn-secondary">View Details</button>
                </div>
              </div>
            </div>

            <div class="segment-card">
              <div class="segment-header">
                <h4>Mobile-First Users</h4>
                <span class="segment-size">1,890 users (15.2%)</span>
              </div>
              <div class="segment-details">
                <p><strong>Characteristics:</strong> Primarily mobile users, quick decisions, social media driven</p>
                <p><strong>Behavior:</strong> Short sessions, visual content preference, impulse buyers</p>
                <div class="segment-actions">
                  <button class="btn-secondary">Edit Segment</button>
                  <button class="btn-secondary">View Details</button>
                </div>
              </div>
            </div>

            <div class="segment-card">
              <div class="segment-header">
                <h4>Returning Customers</h4>
                <span class="segment-size">210 users (1.7%)</span>
              </div>
              <div class="segment-details">
                <p><strong>Characteristics:</strong> Loyal customers, repeat purchases, brand familiarity</p>
                <p><strong>Behavior:</strong> Direct traffic, quick checkout, upsell potential</p>
                <div class="segment-actions">
                  <button class="btn-secondary">Edit Segment</button>
                  <button class="btn-secondary">View Details</button>
                </div>
              </div>
            </div>
          </div>

          <div class="custom-segment">
            <h4>Create Custom Segment</h4>
            <div class="segment-builder">
              <div class="condition-row">
                <select class="condition-field">
                  <option>Age</option>
                  <option>Location</option>
                  <option>Purchase History</option>
                  <option>Engagement Score</option>
                </select>
                <select class="condition-operator">
                  <option>equals</option>
                  <option>greater than</option>
                  <option>less than</option>
                  <option>contains</option>
                </select>
                <input type="text" class="condition-value" placeholder="Value">
                <button class="btn-secondary">Add Condition</button>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-secondary" id="backStep2">Back</button>
          <button class="btn-primary" id="createContent">Create Personalized Content</button>
        </div>
      </div>

      <!-- Step 3: Content Personalization -->
      <div class="step-content" id="step3" style="display: none;">
        <div class="step-header">
          <h2>Content Personalization</h2>
          <p>Create personalized content for each audience segment</p>
        </div>

        <div class="content-personalization">
          <div class="segment-selector">
            <label>Select Segment to Personalize:</label>
            <select id="segmentSelect" class="segment-dropdown">
              <option value="high-value">High-Value Customers</option>
              <option value="price-conscious">Price-Conscious Shoppers</option>
              <option value="new-visitors">New Visitors</option>
              <option value="mobile-first">Mobile-First Users</option>
              <option value="returning">Returning Customers</option>
            </select>
          </div>

          <div class="personalization-tools">
            <div class="tool-section">
              <h4>Content Variations</h4>
              <div class="content-types">
                <div class="content-type-card">
                  <h5>Headlines</h5>
                  <textarea placeholder="Enter base headline..." class="content-input"></textarea>
                  <button class="btn-secondary generate-btn" data-type="headline">Generate Variations</button>
                  <div class="variations-container" id="headlineVariations"></div>
                </div>

                <div class="content-type-card">
                  <h5>Call-to-Actions</h5>
                  <textarea placeholder="Enter base CTA..." class="content-input"></textarea>
                  <button class="btn-secondary generate-btn" data-type="cta">Generate Variations</button>
                  <div class="variations-container" id="ctaVariations"></div>
                </div>

                <div class="content-type-card">
                  <h5>Product Descriptions</h5>
                  <textarea placeholder="Enter base description..." class="content-input"></textarea>
                  <button class="btn-secondary generate-btn" data-type="description">Generate Variations</button>
                  <div class="variations-container" id="descriptionVariations"></div>
                </div>
              </div>
            </div>

            <div class="tool-section">
              <h4>Dynamic Elements</h4>
              <div class="dynamic-elements">
                <div class="element-card">
                  <h5>Personalized Recommendations</h5>
                  <div class="recommendation-settings">
                    <label>
                      <input type="checkbox" checked> Product Recommendations
                    </label>
                    <label>
                      <input type="checkbox" checked> Content Recommendations
                    </label>
                    <label>
                      <input type="checkbox"> Related Articles
                    </label>
                    <label>
                      <input type="checkbox"> Similar Users Liked
                    </label>
                  </div>
                </div>

                <div class="element-card">
                  <h5>Dynamic Pricing</h5>
                  <div class="pricing-settings">
                    <label>
                      <input type="checkbox"> Show Discounts
                    </label>
                    <label>
                      <input type="checkbox"> Loyalty Pricing
                    </label>
                    <label>
                      <input type="checkbox"> Volume Discounts
                    </label>
                    <label>
                      <input type="checkbox"> Time-based Offers
                    </label>
                  </div>
                </div>

                <div class="element-card">
                  <h5>Personalized Images</h5>
                  <div class="image-settings">
                    <label>
                      <input type="checkbox"> Demographic-based
                    </label>
                    <label>
                      <input type="checkbox"> Interest-based
                    </label>
                    <label>
                      <input type="checkbox"> Behavior-based
                    </label>
                    <label>
                      <input type="checkbox"> Location-based
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <h4>Live Preview</h4>
            <div class="preview-container">
              <div class="preview-header">
                <span>Preview for: <strong id="previewSegment">High-Value Customers</strong></span>
                <button class="btn-secondary" id="refreshPreview">Refresh Preview</button>
              </div>
              <div class="preview-content">
                <div class="preview-page">
                  <h3 id="previewHeadline">Exclusive Premium Collection - Just for You!</h3>
                  <p id="previewDescription">Discover our handpicked premium products, carefully selected based on your sophisticated taste and purchase history.</p>
                  <button class="preview-cta" id="previewCTA">Shop Premium Collection</button>
                  <div class="preview-recommendations">
                    <h4>Recommended for You</h4>
                    <div class="recommendation-items">
                      <div class="rec-item">Premium Product A</div>
                      <div class="rec-item">Premium Product B</div>
                      <div class="rec-item">Premium Product C</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-secondary" id="backStep3">Back</button>
          <button class="btn-primary" id="deployPersonalization">Deploy Personalization</button>
        </div>
      </div>

      <!-- Step 4: Deploy & Monitor -->
      <div class="step-content" id="step4" style="display: none;">
        <div class="step-header">
          <h2>Deploy & Monitor</h2>
          <p>Deploy your personalization and monitor performance</p>
        </div>

        <div class="deployment-options">
          <div class="deploy-section">
            <h4>Deployment Settings</h4>
            <div class="deploy-settings">
              <div class="setting-group">
                <label>Deployment Mode</label>
                <select class="deploy-select">
                  <option>Gradual Rollout (Recommended)</option>
                  <option>A/B Test</option>
                  <option>Full Deployment</option>
                  <option>Staging Only</option>
                </select>
              </div>

              <div class="setting-group">
                <label>Traffic Allocation</label>
                <div class="traffic-slider">
                  <input type="range" min="0" max="100" value="25" class="slider" id="trafficSlider">
                  <span id="trafficValue">25%</span> of traffic
                </div>
              </div>

              <div class="setting-group">
                <label>Target Platforms</label>
                <div class="platform-checkboxes">
                  <label><input type="checkbox" checked> Website</label>
                  <label><input type="checkbox" checked> Mobile App</label>
                  <label><input type="checkbox"> Email Campaigns</label>
                  <label><input type="checkbox"> Social Media</label>
                </div>
              </div>
            </div>
          </div>

          <div class="monitoring-section">
            <h4>Performance Monitoring</h4>
            <div class="monitoring-dashboard">
              <div class="metric-card">
                <h5>Conversion Rate</h5>
                <div class="metric-value">+23.5%</div>
                <div class="metric-trend positive">â†— +5.2% vs baseline</div>
              </div>

              <div class="metric-card">
                <h5>Engagement Rate</h5>
                <div class="metric-value">+18.7%</div>
                <div class="metric-trend positive">â†— +3.1% vs baseline</div>
              </div>

              <div class="metric-card">
                <h5>Click-through Rate</h5>
                <div class="metric-value">+31.2%</div>
                <div class="metric-trend positive">â†— +7.8% vs baseline</div>
              </div>

              <div class="metric-card">
                <h5>Revenue per Visitor</h5>
                <div class="metric-value">+42.1%</div>
                <div class="metric-trend positive">â†— +12.3% vs baseline</div>
              </div>
            </div>

            <div class="performance-chart">
              <h5>Performance Over Time</h5>
              <div class="chart-placeholder">
                ðŸ“ˆ Interactive performance chart would be displayed here
              </div>
            </div>
          </div>

          <div class="export-section">
            <h4>Export & Integration</h4>
            <div class="export-options">
              <button class="export-btn" data-action="Export Rules">ðŸ“‹ Export Personalization Rules</button>
              <button class="export-btn" data-action="Download Report">ðŸ“Š Download Performance Report</button>
              <button class="export-btn" data-action="API Integration">ðŸ”— Generate API Integration Code</button>
              <button class="export-btn" data-action="Webhook Setup">âš¡ Setup Performance Webhooks</button>
              <button class="export-btn" data-action="Schedule Reports">ðŸ“… Schedule Automated Reports</button>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-secondary" id="backStep4">Back</button>
          <button class="btn-primary" id="completePersonalization">Complete Setup</button>
        </div>
      </div>
    </div>
  </div>

<style>
.main-content {
  padding: 2rem 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem;
}

.progress-container {
  margin-bottom: 3rem;
}

.progress-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  padding: 1rem 2rem;
  border-radius: 50px;
  backdrop-filter: blur(10px);
}

.progress-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: rgba(255, 255, 255, 0.6);
  transition: all 0.3s ease;
}

.progress-step.active {
  color: white;
}

.step-number {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  margin-bottom: 0.5rem;
  transition: all 0.3s ease;
}

.progress-step.active .step-number {
  background: white;
  color: #667eea;
}

.step-label {
  font-size: 0.9rem;
  font-weight: 500;
}

.step-content {
  background: white;
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.step-header {
  text-align: center;
  margin-bottom: 2rem;
}

.step-header h2 {
  color: #333;
  margin-bottom: 0.5rem;
  font-size: 2rem;
}

.step-header p {
  color: #666;
  font-size: 1.1rem;
}

.form-section {
  margin-bottom: 2rem;
}

.input-group {
  margin-bottom: 2rem;
}

.input-group label {
  display: block;
  margin-bottom: 1rem;
  font-weight: 600;
  color: #333;
  font-size: 1.1rem;
}

.data-sources-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.data-source-card {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
  border: 2px solid transparent;
  transition: all 0.3s ease;
}

.data-source-card:hover {
  border-color: #667eea;
  transform: translateY(-2px);
}

.source-icon {
  font-size: 2rem;
  margin-bottom: 1rem;
}

.data-source-card h4 {
  margin-bottom: 1rem;
  color: #333;
}

.source-input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 1rem;
  font-size: 0.9rem;
}

.parameters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.parameter-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.parameter-item input[type="checkbox"] {
  width: 18px;
  height: 18px;
}

.segments-container {
  margin-bottom: 2rem;
}

.segments-overview {
  margin-bottom: 2rem;
}

.segment-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
}

.stat-card {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
}

.stat-card h3 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.segments-list {
  margin-bottom: 2rem;
}

.segment-card {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  border-left: 4px solid #667eea;
}

.segment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.segment-header h4 {
  color: #333;
  margin: 0;
}

.segment-size {
  color: #667eea;
  font-weight: 600;
}

.segment-details p {
  margin-bottom: 0.5rem;
  color: #666;
}

.segment-actions {
  margin-top: 1rem;
  display: flex;
  gap: 0.5rem;
}

.custom-segment {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
  border: 2px dashed #667eea;
}

.segment-builder {
  margin-top: 1rem;
}

.condition-row {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

.condition-field, .condition-operator, .condition-value {
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  min-width: 120px;
}

.content-personalization {
  margin-bottom: 2rem;
}

.segment-selector {
  margin-bottom: 2rem;
}

.segment-selector label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #333;
}

.segment-dropdown {
  width: 100%;
  max-width: 300px;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 1rem;
}

.personalization-tools {
  margin-bottom: 2rem;
}

.tool-section {
  margin-bottom: 2rem;
}

.tool-section h4 {
  color: #333;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.content-types {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}

.content-type-card {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
}

.content-type-card h5 {
  color: #333;
  margin-bottom: 1rem;
}

.content-input {
  width: 100%;
  min-height: 80px;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 1rem;
  resize: vertical;
}

.generate-btn {
  width: 100%;
  margin-bottom: 1rem;
}

.variations-container {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid #eee;
  border-radius: 8px;
  padding: 1rem;
  background: white;
}

.dynamic-elements {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.element-card {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
}

.element-card h5 {
  color: #333;
  margin-bottom: 1rem;
}

.recommendation-settings, .pricing-settings, .image-settings {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.recommendation-settings label, .pricing-settings label, .image-settings label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: normal;
  color: #666;
}

.preview-section {
  margin-bottom: 2rem;
}

.preview-section h4 {
  color: #333;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.preview-container {
  border: 1px solid #ddd;
  border-radius: 12px;
  overflow: hidden;
}

.preview-header {
  background: #f8f9fa;
  padding: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

.preview-content {
  padding: 2rem;
  background: white;
}

.preview-page {
  max-width: 600px;
  margin: 0 auto;
}

.preview-page h3 {
  color: #333;
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.preview-page p {
  color: #666;
  margin-bottom: 1.5rem;
  line-height: 1.6;
}

.preview-cta {
  background: #667eea;
  color: white;
  padding: 1rem 2rem;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 2rem;
}

.preview-recommendations h4 {
  color: #333;
  margin-bottom: 1rem;
}

.recommendation-items {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.rec-item {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #ddd;
  flex: 1;
  min-width: 150px;
  text-align: center;
}

.deployment-options {
  margin-bottom: 2rem;
}

.deploy-section, .monitoring-section, .export-section {
  margin-bottom: 2rem;
}

.deploy-section h4, .monitoring-section h4, .export-section h4 {
  color: #333;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.deploy-settings {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.setting-group {
  background: #f8f9fa;
  padding: 1.5rem;
  border-radius: 12px;
}

.setting-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #333;
}

.deploy-select {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 8px;
}

.traffic-slider {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.slider {
  flex: 1;
  height: 6px;
  border-radius: 3px;
  background: #ddd;
  outline: none;
}

.platform-checkboxes {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.platform-checkboxes label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: normal;
  color: #666;
}

.monitoring-dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.metric-card {
  background: white;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
}

.metric-card h5 {
  color: #666;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.metric-value {
  font-size: 2rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 0.5rem;
}

.metric-trend {
  font-size: 0.9rem;
  font-weight: 600;
}

.metric-trend.positive {
  color: #28a745;
}

.performance-chart {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 1.5rem;
}

.performance-chart h5 {
  color: #333;
  margin-bottom: 1rem;
}

.chart-placeholder {
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border-radius: 8px;
  color: #666;
  font-size: 1.1rem;
}

.export-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.export-btn {
  background: white;
  border: 2px solid #667eea;
  color: #667eea;
  padding: 1rem;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
}

.export-btn:hover {
  background: #667eea;
  color: white;
}

.step-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #eee;
}

.btn-primary, .btn-secondary {
  padding: 1rem 2rem;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
  background: white;
  color: #667eea;
  border: 2px solid #667eea;
}

.btn-secondary:hover {
  background: #667eea;
  color: white;
}

.cn-bt {
  background: #667eea;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.cn-bt:hover {
  background: #5a67d8;
  transform: translateY(-1px);
}

@media (max-width: 768px) {
  .container {
    padding: 0 1rem;
  }
  
  .progress-bar {
    padding: 1rem;
  }
  
  .step-content {
    padding: 1.5rem;
  }
  
  .data-sources-grid {
    grid-template-columns: 1fr;
  }
  
  .parameters-grid {
    grid-template-columns: 1fr;
  }
  
  .content-types {
    grid-template-columns: 1fr;
  }
  
  .dynamic-elements {
    grid-template-columns: 1fr;
  }
  
  .deploy-settings {
    grid-template-columns: 1fr;
  }
  
  .monitoring-dashboard {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .export-options {
    grid-template-columns: 1fr;
  }
  
  .step-actions {
    flex-direction: column;
    gap: 1rem;
  }
  
  .condition-row {
    flex-direction: column;
    align-items: stretch;
  }
}
</style>

<script>
function showStep(stepNumber) {
  // Hide all steps
  document.querySelectorAll('.step-content').forEach(step => {
    step.style.display = 'none';
  });
  
  // Show current step
  document.getElementById(`step${stepNumber}`).style.display = 'block';
  
  // Update progress bar
  document.querySelectorAll('.progress-step').forEach(step => {
    step.classList.remove('active');
  });
  document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
}

// Step 1: Audience Analysis
document.getElementById('analyzeAudience').addEventListener('click', function() {
  // Simulate analysis
  this.textContent = 'Analyzing...';
  this.disabled = true;
  
  setTimeout(() => {
    this.textContent = 'Analysis Complete!';
    setTimeout(() => {
      showStep(2);
    }, 1000);
  }, 2000);
});

// Step 2: Segments
document.getElementById('backStep2').addEventListener('click', () => showStep(1));
document.getElementById('createContent').addEventListener('click', () => showStep(3));

// Step 3: Content Personalization
document.getElementById('backStep3').addEventListener('click', () => showStep(2));
document.getElementById('deployPersonalization').addEventListener('click', () => showStep(4));

// Segment selector change
document.getElementById('segmentSelect').addEventListener('change', function() {
  const segment = this.value;
  const previewSegment = document.getElementById('previewSegment');
  const previewHeadline = document.getElementById('previewHeadline');
  const previewDescription = document.getElementById('previewDescription');
  const previewCTA = document.getElementById('previewCTA');
  
  const segmentData = {
    'high-value': {
      name: 'High-Value Customers',
      headline: 'Exclusive Premium Collection - Just for You!',
      description: 'Discover our handpicked premium products, carefully selected based on your sophisticated taste and purchase history.',
      cta: 'Shop Premium Collection'
    },
    'price-conscious': {
      name: 'Price-Conscious Shoppers',
      headline: 'Amazing Deals & Discounts - Save Big Today!',
      description: 'Get the best value for your money with our exclusive deals and limited-time offers.',
      cta: 'View All Deals'
    },
    'new-visitors': {
      name: 'New Visitors',
      headline: 'Welcome! Discover What Makes Us Special',
      description: 'New here? Start your journey with our most popular products and see why customers love us.',
      cta: 'Explore Now'
    },
    'mobile-first': {
      name: 'Mobile-First Users',
      headline: 'ðŸ“± Quick & Easy Mobile Shopping',
      description: 'Shop on-the-go with our mobile-optimized experience. Fast checkout, instant results.',
      cta: 'Shop Now'
    },
    'returning': {
      name: 'Returning Customers',
      headline: 'Welcome Back! Here\'s What\'s New',
      description: 'Thanks for coming back! Check out our latest arrivals and your personalized recommendations.',
      cta: 'See What\'s New'
    }
  };
  
  const data = segmentData[segment];
  previewSegment.textContent = data.name;
  previewHeadline.textContent = data.headline;
  previewDescription.textContent = data.description;
  previewCTA.textContent = data.cta;
});

// Generate variations
document.querySelectorAll('.generate-btn').forEach(button => {
  button.addEventListener('click', function() {
    const type = this.dataset.type;
    const input = this.previousElementSibling;
    const container = this.nextElementSibling;
    
    if (!input.value.trim()) {
      alert('Please enter some content first!');
      return;
    }
    
    this.textContent = 'Generating...';
    this.disabled = true;
    
    setTimeout(() => {
      const variations = generateVariations(type, input.value);
      container.innerHTML = variations.map(variation => 
        `<div class="variation-item" style="padding: 0.5rem; margin-bottom: 0.5rem; background: #f8f9fa; border-radius: 6px; cursor: pointer;" onclick="selectVariation(this, '${type}')">${variation}</div>`
      ).join('');
      
      this.textContent = 'Generate Variations';
      this.disabled = false;
    }, 1500);
  });
});

function generateVariations(type, baseContent) {
  const variations = {
    headline: [
      `${baseContent} - Limited Time!`,
      `Exclusive: ${baseContent}`,
      `Don't Miss: ${baseContent}`,
      `New: ${baseContent}`
    ],
    cta: [
      `${baseContent} Now`,
      `Get ${baseContent}`,
      `Start ${baseContent}`,
      `Try ${baseContent} Free`
    ],
    description: [
      `${baseContent} Perfect for your needs.`,
      `${baseContent} Join thousands of satisfied customers.`,
      `${baseContent} Get started in minutes.`,
      `${baseContent} Risk-free guarantee.`
    ]
  };
  
  return variations[type] || [baseContent];
}

function selectVariation(element, type) {
  // Remove previous selections
  element.parentNode.querySelectorAll('.variation-item').forEach(item => {
    item.style.background = '#f8f9fa';
    item.style.border = 'none';
  });
  
  // Highlight selected
  element.style.background = '#667eea';
  element.style.color = 'white';
  element.style.border = '2px solid #5a67d8';
  
  // Update preview
  const segment = document.getElementById('segmentSelect').value;
  if (type === 'headline') {
    document.getElementById('previewHeadline').textContent = element.textContent;
  } else if (type === 'cta') {
    document.getElementById('previewCTA').textContent = element.textContent;
  } else if (type === 'description') {
    document.getElementById('previewDescription').textContent = element.textContent;
  }
}

// Refresh preview
document.getElementById('refreshPreview').addEventListener('click', function() {
  this.textContent = 'Refreshing...';
  setTimeout(() => {
    this.textContent = 'Refresh Preview';
    alert('Preview refreshed with latest changes!');
  }, 1000);
});

// Step 4: Deploy & Monitor
document.getElementById('backStep4').addEventListener('click', () => showStep(3));

// Traffic slider
const trafficSlider = document.getElementById('trafficSlider');
const trafficValue = document.getElementById('trafficValue');

trafficSlider.addEventListener('input', function() {
  trafficValue.textContent = this.value + '%';
});

// Export buttons
document.querySelectorAll('.export-btn').forEach(button => {
  button.addEventListener('click', function() {
    const action = this.dataset.action;
    
    if (action === 'Export Rules') {
      const rules = {
        segments: ['High-Value Customers', 'Price-Conscious Shoppers', 'New Visitors', 'Mobile-First Users', 'Returning Customers'],
        personalization: {
          headlines: 'Dynamic based on segment',
          ctas: 'Personalized call-to-actions',
          recommendations: 'AI-powered product suggestions'
        },
        deployment: {
          mode: 'Gradual Rollout',
          traffic: document.getElementById('trafficSlider').value + '%'
        }
      };
      
      const blob = new Blob([JSON.stringify(rules, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'personalization-rules.json';
      a.click();
      URL.revokeObjectURL(url);
    } else if (action === 'Download Report') {
      const report = `Personalization Performance Report
      
Generated: ${new Date().toLocaleDateString()}

Key Metrics:
- Conversion Rate: +23.5% improvement
- Engagement Rate: +18.7% improvement  
- Click-through Rate: +31.2% improvement
- Revenue per Visitor: +42.1% improvement

Segments Performance:
- High-Value Customers: 18.8% of audience, highest conversion
- Price-Conscious Shoppers: 31.2% of audience, responds well to deals
- New Visitors: 33.1% of audience, needs nurturing
- Mobile-First Users: 15.2% of audience, quick decisions
- Returning Customers: 1.7% of audience, high loyalty

Recommendations:
1. Increase traffic allocation to 50%
2. Focus on mobile optimization
3. Expand new visitor nurturing campaigns
4. Create more premium content for high-value segment
`;
      
      const blob = new Blob([report], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'personalization-report.txt';
      a.click();
      URL.revokeObjectURL(url);
    } else if (action === 'API Integration') {
      const code = `// Personalization API Integration
const personalizationAPI = {
  baseURL: 'https://api.yoursite.com/personalization',
  
  async getPersonalizedContent(userId, segment) {
    const response = await fetch(\`\${this.baseURL}/content\`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer YOUR_API_KEY'
      },
      body: JSON.stringify({
        userId: userId,
        segment: segment,
        contentTypes: ['headline', 'cta', 'description', 'recommendations']
      })
    });
    
    return await response.json();
  },
  
  async trackEvent(userId, event, data) {
    await fetch(\`\${this.baseURL}/events\`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer YOUR_API_KEY'
      },
      body: JSON.stringify({
        userId: userId,
        event: event,
        data: data,
        timestamp: new Date().toISOString()
      })
    });
  }
};

// Usage example
personalizationAPI.getPersonalizedContent('user123', 'high-value')
  .then(content => {
    document.getElementById('headline').textContent = content.headline;
    document.getElementById('cta').textContent = content.cta;
    // Apply other personalizations
  });`;
      
      const blob = new Blob([code], { type: 'text/javascript' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'personalization-api.js';
      a.click();
      URL.revokeObjectURL(url);
    } else {
      alert(`${action} functionality will be implemented soon!`);
    }
  });
});

document.getElementById('completePersonalization').addEventListener('click', function() {
  alert('Personalization engine deployed successfully! ðŸŽ‰\n\nYour personalized experiences are now live and will continuously optimize based on user behavior.');
  // Reset to step 1
  showStep(1);
});

// Connect buttons
document.querySelectorAll('.cn-bt').forEach(button => {
  button.addEventListener('click', function() {
    const card = this.closest('.data-source-card');
    const title = card.querySelector('h4').textContent;
    
    this.textContent = 'Connecting...';
    this.disabled = true;
    
    setTimeout(() => {
      this.textContent = 'Connected âœ“';
      this.style.background = '#28a745';
      card.style.borderColor = '#28a745';
    }, 1500);
  });
});

// Initialize
showStep(1);
</script>
</Layout>