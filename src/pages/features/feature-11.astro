---
import Layout from '../../layouts/Layout.astro';
import Nav from '../../components/Nav.astro';
---
<Layout>
<Nav/>
<main class="mn">
  <div class="pg-hd">
    <div class="hd-ic">üõí</div>
    <h1 class="tl">E-commerce Optimization</h1>
    <p class="st">Optimize product pages, descriptions, and structured data for better conversions</p>
  </div>

  <!-- Progress -->
  <div class="pr-wr">
    <div class="pr-st" id="progressBar">
      <div class="pr-it cp" data-step="1"><div class="pr-nm">1</div><div class="pr-lb">Product</div></div>
      <div class="pr-ln"></div>
      <div class="pr-it" data-step="2"><div class="pr-nm">2</div><div class="pr-lb">Analyze</div></div>
      <div class="pr-ln"></div>
      <div class="pr-it" data-step="3"><div class="pr-nm">3</div><div class="pr-lb">Optimize</div></div>
      <div class="pr-ln"></div>
      <div class="pr-it" data-step="4"><div class="pr-nm">4</div><div class="pr-lb">Schema</div></div>
      <div class="pr-ln"></div>
      <div class="pr-it" data-step="5"><div class="pr-nm">5</div><div class="pr-lb">Export</div></div>
    </div>
  </div>

  <div class="st-cn">
    <!-- Step 1: Product Input -->
    <div class="st-bx" id="step1">
      <div class="st-ic">üì¶</div>
      <div class="st-hd">
        <h2>Product Information</h2>
        <p>Enter your product details or import from existing page</p>
      </div>
      <div class="st-bd">
        <div class="fm-gd">
          <div class="fm-gr">
            <label class="fm-lb">
              <span class="lb-tx">Product Source<span class="rq">*</span></span>
              <select id="productSource" class="fm-sl">
                <option value="manual">Manual Entry</option>
                <option value="url">Import from URL</option>
                <option value="csv">Upload CSV</option>
              </select>
            </label>
          </div>
          <div class="fm-gr" id="manualInput">
            <label class="fm-lb">
              <span class="lb-tx">Product Name<span class="rq">*</span></span>
              <input id="productName" class="fm-in" type="text" placeholder="Enter product name"/>
            </label>
          </div>
          <div class="fm-gr" id="urlInput" style="display:none">
            <label class="fm-lb">
              <span class="lb-tx">Product Page URL<span class="rq">*</span></span>
              <input id="productUrl" class="fm-in" type="url" placeholder="https://example.com/product"/>
            </label>
          </div>
          <div class="fm-gr" id="csvInput" style="display:none">
            <label class="fm-lb">
              <span class="lb-tx">Upload CSV File<span class="rq">*</span></span>
              <input id="csvFile" class="fm-in" type="file" accept=".csv"/>
            </label>
          </div>
          <div class="fm-gr">
            <label class="fm-lb">
              <span class="lb-tx">Product Category</span>
              <select id="productCategory" class="fm-sl">
                <option value="electronics">Electronics</option>
                <option value="clothing">Clothing & Fashion</option>
                <option value="home">Home & Garden</option>
                <option value="beauty">Beauty & Personal Care</option>
                <option value="sports">Sports & Outdoors</option>
                <option value="books">Books & Media</option>
                <option value="other">Other</option>
              </select>
            </label>
          </div>
        </div>
        <div class="bt-gr">
          <button class="bt-pr" id="nextStep1"><span>Analyze Product</span><span class="bt-ar">‚Üí</span></button>
        </div>
      </div>
    </div>

    <!-- Step 2: Analysis -->
    <div class="st-bx" id="step2" style="display:none">
      <div class="st-ic">üîç</div>
      <div class="st-hd">
        <h2>Product Analysis</h2>
        <p>AI analysis of your product page and optimization opportunities</p>
      </div>
      <div class="st-bd">
        <div class="ld-wr" id="analysisLoader">
          <div class="ld-sp"></div>
          <p>Analyzing product page...</p>
        </div>
        <div id="analysisResults" style="display:none">
          <div class="an-gd">
            <div class="an-cd">
              <div class="an-ic">üìä</div>
              <h3>SEO Score</h3>
              <div class="sc-wr">
                <div class="sc-br" id="seoScore">
                  <div class="sc-fl" style="width: 0%"></div>
                </div>
                <span class="sc-tx" id="seoScoreText">0/100</span>
              </div>
            </div>
            <div class="an-cd">
              <div class="an-ic">üí∞</div>
              <h3>Conversion Score</h3>
              <div class="sc-wr">
                <div class="sc-br" id="conversionScore">
                  <div class="sc-fl" style="width: 0%"></div>
                </div>
                <span class="sc-tx" id="conversionScoreText">0/100</span>
              </div>
            </div>
            <div class="an-cd">
              <div class="an-ic">üì±</div>
              <h3>Mobile Score</h3>
              <div class="sc-wr">
                <div class="sc-br" id="mobileScore">
                  <div class="sc-fl" style="width: 0%"></div>
                </div>
                <span class="sc-tx" id="mobileScoreText">0/100</span>
              </div>
            </div>
          </div>
          <div class="is-ls" id="issuesList">
            <h3>Issues Found</h3>
            <div class="is-it">
              <div class="is-ic">‚ö†Ô∏è</div>
              <div class="is-tx">
                <strong>Missing product schema markup</strong>
                <p>Add structured data to improve search visibility</p>
              </div>
            </div>
          </div>
        </div>
        <div class="bt-gr">
          <button class="bt-sc" id="backStep2"><span class="bt-ar">‚Üê</span><span>Back</span></button>
          <button class="bt-pr" id="nextStep2"><span>Start Optimization</span><span class="bt-ar">‚Üí</span></button>
        </div>
      </div>
    </div>

    <!-- Step 3: Optimization -->
    <div class="st-bx" id="step3" style="display:none">
      <div class="st-ic">‚ö°</div>
      <div class="st-hd">
        <h2>Product Optimization</h2>
        <p>Optimize product title, description, and key elements</p>
      </div>
      <div class="st-bd">
        <div class="op-tb">
          <div class="tb-hd">
            <button class="tb-bt cp" data-tab="title">Title</button>
            <button class="tb-bt" data-tab="description">Description</button>
            <button class="tb-bt" data-tab="images">Images</button>
            <button class="tb-bt" data-tab="pricing">Pricing</button>
          </div>
          <div class="tb-ct">
            <div class="tb-pn cp" id="titleTab">
              <div class="op-gr">
                <label class="fm-lb">
                  <span class="lb-tx">Original Title</span>
                  <input id="originalTitle" class="fm-in" type="text" readonly/>
                </label>
                <label class="fm-lb">
                  <span class="lb-tx">Optimized Title</span>
                  <input id="optimizedTitle" class="fm-in" type="text"/>
                </label>
                <button class="bt-gn" id="generateTitle"><span class="gn-ic">‚öôÔ∏è</span><span>Generate Title</span></button>
              </div>
            </div>
            <div class="tb-pn" id="descriptionTab">
              <div class="op-gr">
                <label class="fm-lb">
                  <span class="lb-tx">Original Description</span>
                  <textarea id="originalDescription" class="fm-tx" rows="4" readonly></textarea>
                </label>
                <label class="fm-lb">
                  <span class="lb-tx">Optimized Description</span>
                  <textarea id="optimizedDescription" class="fm-tx" rows="6"></textarea>
                </label>
                <button class="bt-gn" id="generateDescription"><span class="gn-ic">‚öôÔ∏è</span><span>Generate Description</span></button>
              </div>
            </div>
            <div class="tb-pn" id="imagesTab">
              <div class="op-gr">
                <h4>Image Optimization</h4>
                <div class="im-ls" id="imagesList">
                  <div class="im-it">
                    <div class="im-th">üì∑</div>
                    <div class="im-dt">
                      <input class="fm-in" placeholder="Alt text" value="Product main image"/>
                      <input class="fm-in" placeholder="Title" value=""/>
                    </div>
                    <button class="bt-sm">Optimize</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="tb-pn" id="pricingTab">
              <div class="op-gr">
                <div class="pr-gd">
                  <label class="fm-lb">
                    <span class="lb-tx">Price</span>
                    <input id="productPrice" class="fm-in" type="number" step="0.01" placeholder="0.00"/>
                  </label>
                  <label class="fm-lb">
                    <span class="lb-tx">Currency</span>
                    <select id="productCurrency" class="fm-sl">
                      <option value="USD">USD</option>
                      <option value="EUR">EUR</option>
                      <option value="GBP">GBP</option>
                    </select>
                  </label>
                  <label class="fm-lb">
                    <span class="lb-tx">Sale Price</span>
                    <input id="salePrice" class="fm-in" type="number" step="0.01" placeholder="0.00"/>
                  </label>
                  <label class="fm-lb">
                    <span class="lb-tx">Availability</span>
                    <select id="availability" class="fm-sl">
                      <option value="InStock">In Stock</option>
                      <option value="OutOfStock">Out of Stock</option>
                      <option value="PreOrder">Pre-order</option>
                    </select>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bt-gr">
          <button class="bt-sc" id="backStep3"><span class="bt-ar">‚Üê</span><span>Back</span></button>
          <button class="bt-pr" id="nextStep3"><span>Generate Schema</span><span class="bt-ar">‚Üí</span></button>
        </div>
      </div>
    </div>

    <!-- Step 4: Schema Generation -->
    <div class="st-bx" id="step4" style="display:none">
      <div class="st-ic">üè∑Ô∏è</div>
      <div class="st-hd">
        <h2>Schema Markup</h2>
        <p>Generate structured data for better search visibility</p>
      </div>
      <div class="st-bd">
        <div class="sc-gd">
          <div class="sc-cd">
            <h3>Product Schema</h3>
            <div class="cd-bx">
              <pre id="productSchema" class="cd-tx"></pre>
              <button class="cp-bt" id="copyProductSchema">Copy</button>
            </div>
          </div>
          <div class="sc-cd">
            <h3>Review Schema</h3>
            <div class="cd-bx">
              <pre id="reviewSchema" class="cd-tx"></pre>
              <button class="cp-bt" id="copyReviewSchema">Copy</button>
            </div>
          </div>
          <div class="sc-cd">
            <h3>Breadcrumb Schema</h3>
            <div class="cd-bx">
              <pre id="breadcrumbSchema" class="cd-tx"></pre>
              <button class="cp-bt" id="copyBreadcrumbSchema">Copy</button>
            </div>
          </div>
        </div>
        <div class="bt-gr">
          <button class="bt-sc" id="backStep4"><span class="bt-ar">‚Üê</span><span>Back</span></button>
          <button class="bt-pr" id="nextStep4"><span>Export Results</span><span class="bt-ar">‚Üí</span></button>
        </div>
      </div>
    </div>

    <!-- Step 5: Export -->
    <div class="st-bx" id="step5" style="display:none">
      <div class="st-ic">üì§</div>
      <div class="st-hd">
        <h2>Export Optimization</h2>
        <p>Download your optimized product data and implementation guide</p>
      </div>
      <div class="st-bd">
        <div class="ex-gd">
          <button class="ex-cd" id="downloadHTML">
            <div class="ex-ic">üìÑ</div>
            <div class="ex-tx">
              <h4>HTML Template</h4>
              <p>Complete product page with optimizations</p>
            </div>
          </button>
          <button class="ex-cd" id="downloadJSON">
            <div class="ex-ic">üìã</div>
            <div class="ex-tx">
              <h4>JSON Data</h4>
              <p>Product data and schema markup</p>
            </div>
          </button>
          <button class="ex-cd" id="downloadCSV">
            <div class="ex-ic">üìä</div>
            <div class="ex-tx">
              <h4>CSV Export</h4>
              <p>Bulk product data for import</p>
            </div>
          </button>
          <button class="ex-cd" id="copyToClipboard">
            <div class="ex-ic">üìã</div>
            <div class="ex-tx">
              <h4>Copy to Clipboard</h4>
              <p>Quick copy optimized content</p>
            </div>
          </button>
          <button class="ex-cd" id="generateReport">
            <div class="ex-ic">üìà</div>
            <div class="ex-tx">
              <h4>Optimization Report</h4>
              <p>Detailed analysis and recommendations</p>
            </div>
          </button>
          <button class="ex-cd" id="scheduleUpdate">
            <div class="ex-ic">‚è∞</div>
            <div class="ex-tx">
              <h4>Schedule Updates</h4>
              <p>Automated optimization monitoring</p>
            </div>
          </button>
        </div>
        <div class="bt-gr">
          <button class="bt-sc" id="backStep5"><span class="bt-ar">‚Üê</span><span>Back</span></button>
          <button class="bt-pr" id="restartProcess"><span>Optimize Another Product</span><span class="bt-ar">üîÑ</span></button>
        </div>
      </div>
    </div>
  </div>
</main>

<style>
  .mn { max-width: 1200px; margin: 0 auto; padding: 2rem; }
  .pg-hd { text-align: center; margin-bottom: 3rem; }
  .hd-ic { font-size: 3rem; margin-bottom: 1rem; }
  .tl { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #1a1a1a; }
  .st { font-size: 1.2rem; color: #666; margin-bottom: 2rem; }

  .pr-wr { margin-bottom: 3rem; }
  .pr-st { display: flex; align-items: center; justify-content: center; gap: 1rem; }
  .pr-it { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
  .pr-nm { width: 2.5rem; height: 2.5rem; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center; font-weight: 600; }
  .pr-lb { font-size: 0.875rem; color: #666; }
  .pr-ln { width: 3rem; height: 2px; background: #e5e7eb; }
  .pr-it.cp .pr-nm { background: #3b82f6; color: white; }
  .pr-it.cp .pr-lb { color: #3b82f6; font-weight: 600; }

  .st-cn { max-width: 800px; margin: 0 auto; }
  .st-bx { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
  .st-ic { font-size: 2rem; margin-bottom: 1rem; }
  .st-hd { margin-bottom: 2rem; }
  .st-hd h2 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
  .st-hd p { color: #666; }

  .fm-gd { display: grid; gap: 1.5rem; margin-bottom: 2rem; }
  .fm-gr { display: flex; flex-direction: column; gap: 0.5rem; }
  .fm-lb { display: flex; flex-direction: column; gap: 0.5rem; }
  .lb-tx { font-weight: 500; color: #374151; }
  .rq { color: #ef4444; }
  .fm-in, .fm-sl, .fm-tx { padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; }
  .fm-in:focus, .fm-sl:focus, .fm-tx:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }

  .bt-gr { display: flex; gap: 1rem; justify-content: flex-end; }
  .bt-pr, .bt-sc, .bt-gn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; border: none; }
  .bt-pr { background: #3b82f6; color: white; }
  .bt-pr:hover { background: #2563eb; }
  .bt-sc { background: #f3f4f6; color: #374151; }
  .bt-sc:hover { background: #e5e7eb; }
  .bt-gn { background: #10b981; color: white; }
  .bt-gn:hover { background: #059669; }
  .bt-ar { font-size: 1.2rem; }
  .gn-ic { font-size: 1rem; }

  .ld-wr { text-align: center; padding: 3rem; }
  .ld-sp { width: 3rem; height: 3rem; border: 3px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .an-gd { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
  .an-cd { text-align: center; padding: 1.5rem; background: #f9fafb; border-radius: 8px; }
  .an-ic { font-size: 2rem; margin-bottom: 0.5rem; }
  .sc-wr { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; }
  .sc-br { flex: 1; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; }
  .sc-fl { height: 100%; background: #10b981; transition: width 0.5s ease; }
  .sc-tx { font-weight: 600; color: #374151; }

  .is-ls { background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1.5rem; }
  .is-ls h3 { color: #dc2626; margin-bottom: 1rem; }
  .is-it { display: flex; gap: 1rem; margin-bottom: 1rem; }
  .is-ic { font-size: 1.5rem; }
  .is-tx strong { color: #dc2626; }
  .is-tx p { color: #7f1d1d; margin-top: 0.25rem; }

  .op-tb { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
  .tb-hd { display: flex; background: #f9fafb; }
  .tb-bt { padding: 1rem 1.5rem; border: none; background: none; cursor: pointer; border-right: 1px solid #e5e7eb; }
  .tb-bt.cp { background: white; color: #3b82f6; font-weight: 600; }
  .tb-ct { padding: 2rem; }
  .tb-pn { display: none; }
  .tb-pn.cp { display: block; }
  .op-gr { display: grid; gap: 1.5rem; }

  .pr-gd { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }

  .im-ls { display: grid; gap: 1rem; }
  .im-it { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 6px; }
  .im-th { font-size: 2rem; }
  .im-dt { flex: 1; display: grid; gap: 0.5rem; }
  .bt-sm { padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }

  .sc-gd { display: grid; gap: 1.5rem; }
  .sc-cd { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
  .sc-cd h3 { padding: 1rem; background: #f9fafb; margin: 0; font-size: 1.1rem; }
  .cd-bx { position: relative; }
  .cd-tx { background: #1f2937; color: #f9fafb; padding: 1.5rem; margin: 0; font-family: 'Courier New', monospace; font-size: 0.875rem; overflow-x: auto; }
  .cp-bt { position: absolute; top: 1rem; right: 1rem; padding: 0.5rem 1rem; background: #374151; color: white; border: none; border-radius: 4px; cursor: pointer; }

  .ex-gd { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
  .ex-cd { display: flex; align-items: center; gap: 1rem; padding: 1.5rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: left; }
  .ex-cd:hover { background: #f3f4f6; }
  .ex-ic { font-size: 2rem; }
  .ex-tx h4 { margin: 0 0 0.25rem 0; font-size: 1.1rem; }
  .ex-tx p { margin: 0; color: #666; font-size: 0.9rem; }
</style>

<script>
  let currentStep: number = 1;
  const totalSteps: number = 5;

  // Navigation functions
  function showStep(step: number): void {
    // Hide all steps
    for (let i = 1; i <= totalSteps; i++) {
      const stepEl = document.getElementById(`step${i}`) as HTMLElement | null;
      if (stepEl) stepEl.style.display = 'none';
    }
    
    // Show current step
    const currentStepEl = document.getElementById(`step${step}`) as HTMLElement | null;
    if (currentStepEl) currentStepEl.style.display = 'block';
    
    // Update progress bar
    updateProgressBar(step);
    currentStep = step;
  }

  function updateProgressBar(step: number): void {
    const progressItems = document.querySelectorAll('.pr-it');
    progressItems.forEach((item, index) => {
      if (index + 1 <= step) {
        item.classList.add('cp');
      } else {
        item.classList.remove('cp');
      }
    });
  }

  // Step 1: Product Input
  document.getElementById('productSource')?.addEventListener('change', (e: Event) => {
    const source = (e.target as HTMLSelectElement).value;
    const mi = document.getElementById('manualInput') as HTMLElement | null;
    const ui = document.getElementById('urlInput') as HTMLElement | null;
    const ci = document.getElementById('csvInput') as HTMLElement | null;
    if (mi) mi.style.display = source === 'manual' ? 'block' : 'none';
    if (ui) ui.style.display = source === 'url' ? 'block' : 'none';
    if (ci) ci.style.display = source === 'csv' ? 'block' : 'none';
  });

  document.getElementById('nextStep1')?.addEventListener('click', () => {
    const source = (document.getElementById('productSource') as HTMLSelectElement | null)?.value || '';
    let isValid = false;
    
    if (source === 'manual') {
      const pn = document.getElementById('productName') as HTMLInputElement | null;
      isValid = (pn?.value || '').trim() !== '';
    } else if (source === 'url') {
      const pu = document.getElementById('productUrl') as HTMLInputElement | null;
      isValid = (pu?.value || '').trim() !== '';
    } else if (source === 'csv') {
      const cf = document.getElementById('csvFile') as HTMLInputElement | null;
      isValid = (cf?.files?.length || 0) > 0;
    }
    
    if (isValid) {
      showStep(2);
      startAnalysis();
    } else {
      alert('Please fill in the required fields');
    }
  });

  // Step 2: Analysis
  function startAnalysis(): void {
    const loader = document.getElementById('analysisLoader') as HTMLElement | null;
    const results = document.getElementById('analysisResults') as HTMLElement | null;
    
    if (loader) loader.style.display = 'block';
    if (results) results.style.display = 'none';
    
    setTimeout(() => {
      if (loader) loader.style.display = 'none';
      if (results) results.style.display = 'block';
      
      // Animate scores
      animateScore('seoScore', 'seoScoreText', 75);
      animateScore('conversionScore', 'conversionScoreText', 68);
      animateScore('mobileScore', 'mobileScoreText', 82);
      
      // Add more issues
      const issuesList = document.getElementById('issuesList') as HTMLElement | null;
      const additionalIssues = [
        { icon: '‚ö†Ô∏è', title: 'Product title too short', desc: 'Consider adding more descriptive keywords' },
        { icon: 'üì±', title: 'Images not optimized', desc: 'Add alt text and optimize file sizes' },
        { icon: 'üí∞', title: 'Missing price comparison', desc: 'Show competitive pricing information' }
      ];
      
      additionalIssues.forEach(issue => {
        const issueEl = document.createElement('div');
        issueEl.className = 'is-it';
        issueEl.innerHTML = `
          <div class="is-ic">${issue.icon}</div>
          <div class="is-tx">
            <strong>${issue.title}</strong>
            <p>${issue.desc}</p>
          </div>
        `;
        if (issuesList) issuesList.appendChild(issueEl);
      });
    }, 2000);
  }

  function animateScore(barId: string, textId: string, targetScore: number): void {
    const bar = document.getElementById(barId)?.querySelector('.sc-fl') as HTMLElement | null;
    const text = document.getElementById(textId) as HTMLElement | null;
    let currentScore = 0;
    
    const interval = setInterval(() => {
      currentScore += 2;
      if (bar) bar.style.width = `${currentScore}%`;
      if (text) text.textContent = `${currentScore}/100`;
      
      if (currentScore >= targetScore) {
        clearInterval(interval);
      }
    }, 30);
  }

  document.getElementById('backStep2')?.addEventListener('click', () => showStep(1));
  document.getElementById('nextStep2')?.addEventListener('click', () => {
    showStep(3);
    loadOptimizationData();
  });

  // Step 3: Optimization
  function loadOptimizationData(): void {
    const productName = (document.getElementById('productName') as HTMLInputElement | null)?.value || 'Sample Product';
    const ot = document.getElementById('originalTitle') as HTMLInputElement | null;
    const od = document.getElementById('originalDescription') as HTMLTextAreaElement | null;
    if (ot) ot.value = productName;
    if (od) od.value = 'Original product description...';
  }

  // Tab functionality
  document.querySelectorAll('.tb-bt').forEach((button) => {
    button.addEventListener('click', (e: MouseEvent) => {
      const btn = e.currentTarget as HTMLElement;
      const tab = btn.dataset.tab || '';
      
      // Update buttons
      document.querySelectorAll('.tb-bt').forEach((b) => (b as HTMLElement).classList.remove('cp'));
      btn.classList.add('cp');
      
      // Update panels
      document.querySelectorAll('.tb-pn').forEach((panel) => (panel as HTMLElement).classList.remove('cp'));
      const panel = document.getElementById(`${tab}Tab`);
      panel?.classList.add('cp');
    });
  });

  // Generate functions
  document.getElementById('generateTitle')?.addEventListener('click', () => {
    const original = (document.getElementById('originalTitle') as HTMLInputElement | null)?.value || '';
    const optimized = `${original} - Premium Quality | Best Price | Free Shipping`;
    const ot = document.getElementById('optimizedTitle') as HTMLInputElement | null;
    if (ot) ot.value = optimized;
  });

  document.getElementById('generateDescription')?.addEventListener('click', () => {
    const optimized = `Experience the ultimate in quality and performance with our premium product. 

Key Features:
‚Ä¢ High-quality materials and construction
‚Ä¢ Advanced technology for superior performance  
‚Ä¢ Ergonomic design for maximum comfort
‚Ä¢ Backed by our satisfaction guarantee

Perfect for both beginners and professionals, this product delivers exceptional value and reliability. Order now and enjoy free shipping on all orders over $50.

Why Choose Us:
‚úì 30-day money-back guarantee
‚úì Expert customer support
‚úì Fast, secure shipping
‚úì Trusted by thousands of customers`;
    
    const od = document.getElementById('optimizedDescription') as HTMLTextAreaElement | null;
    if (od) od.value = optimized;
  });

  document.getElementById('backStep3')?.addEventListener('click', () => showStep(2));
  document.getElementById('nextStep3')?.addEventListener('click', () => {
    showStep(4);
    generateSchemas();
  });

  // Step 4: Schema Generation
  function generateSchemas(): void {
    const productName = (document.getElementById('optimizedTitle') as HTMLInputElement | null)?.value || (document.getElementById('originalTitle') as HTMLInputElement | null)?.value || 'Product Name';
    const price = (document.getElementById('productPrice') as HTMLInputElement | null)?.value || '99.99';
    const currency = (document.getElementById('productCurrency') as HTMLSelectElement | null)?.value || 'USD';
    
    const productSchema = {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": productName,
      "description": (document.getElementById('optimizedDescription') as HTMLTextAreaElement | null)?.value || "Product description",
      "offers": {
        "@type": "Offer",
        "price": price,
        "priceCurrency": currency,
        "availability": "https://schema.org/InStock"
      },
      "brand": {
        "@type": "Brand",
        "name": "Your Brand"
      }
    };
    
    const reviewSchema = {
      "@context": "https://schema.org/",
      "@type": "Review",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5"
      },
      "author": {
        "@type": "Person",
        "name": "Customer Name"
      }
    };
    
    const breadcrumbSchema = {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://example.com/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Products",
          "item": "https://example.com/products"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": productName
        }
      ]
    };
    
    const ps = document.getElementById('productSchema') as HTMLElement | null;
    const rs = document.getElementById('reviewSchema') as HTMLElement | null;
    const bs = document.getElementById('breadcrumbSchema') as HTMLElement | null;
    if (ps) ps.textContent = JSON.stringify(productSchema, null, 2);
    if (rs) rs.textContent = JSON.stringify(reviewSchema, null, 2);
    if (bs) bs.textContent = JSON.stringify(breadcrumbSchema, null, 2);
  }

  // Copy functions
  document.getElementById('copyProductSchema')?.addEventListener('click', () => copyToClipboard('productSchema'));
  document.getElementById('copyReviewSchema')?.addEventListener('click', () => copyToClipboard('reviewSchema'));
  document.getElementById('copyBreadcrumbSchema')?.addEventListener('click', () => copyToClipboard('breadcrumbSchema'));

  function copyToClipboard(elementId: string): void {
    const element = document.getElementById(elementId) as HTMLElement | null;
    if (element && element.textContent) {
      navigator.clipboard.writeText(element.textContent).then(() => {
        alert('Copied to clipboard!');
      }).catch(() => {/* noop */});
    }
  }

  document.getElementById('backStep4')?.addEventListener('click', () => showStep(3));
  document.getElementById('nextStep4')?.addEventListener('click', () => showStep(5));

  // Step 5: Export
  document.getElementById('downloadHTML')?.addEventListener('click', () => downloadFile('product-page.html', generateHTML()));
  document.getElementById('downloadJSON')?.addEventListener('click', () => downloadFile('product-data.json', generateJSON()));
  document.getElementById('downloadCSV')?.addEventListener('click', () => downloadFile('product-data.csv', generateCSV()));
  document.getElementById('copyToClipboard')?.addEventListener('click', () => copyOptimizedContent());
  document.getElementById('generateReport')?.addEventListener('click', () => downloadFile('optimization-report.html', generateReport()));
  document.getElementById('scheduleUpdate')?.addEventListener('click', () => alert('Scheduling feature coming soon!'));

  function downloadFile(filename: string, content: string): void {
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  function generateHTML(): string {
    const title = (document.getElementById('optimizedTitle') as HTMLInputElement | null)?.value || 'Product Title';
    const description = (document.getElementById('optimizedDescription') as HTMLTextAreaElement | null)?.value || 'Product description';
    const schema = (document.getElementById('productSchema') as HTMLElement | null)?.textContent || '{}';
    
    return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <script type="application/ld+json">
    ${schema}
    </script>
</head>
<body>
    <h1>${title}</h1>
    <div class="product-description">
        ${description.replace(/\n/g, '<br>')}
    </div>
</body>
</html>`;
  }

  function generateJSON(): string {
    let schemaObj: unknown = {};
    const schemaText = (document.getElementById('productSchema') as HTMLElement | null)?.textContent || '{}';
    try {
      schemaObj = JSON.parse(schemaText);
    } catch {
      schemaObj = {};
    }
    return JSON.stringify({
      title: (document.getElementById('optimizedTitle') as HTMLInputElement | null)?.value || '',
      description: (document.getElementById('optimizedDescription') as HTMLTextAreaElement | null)?.value || '',
      price: (document.getElementById('productPrice') as HTMLInputElement | null)?.value || '',
      currency: (document.getElementById('productCurrency') as HTMLSelectElement | null)?.value || 'USD',
      schema: schemaObj
    }, null, 2);
  }

  function generateCSV(): string {
    const title = (document.getElementById('optimizedTitle') as HTMLInputElement | null)?.value || '';
    const descriptionRaw = (document.getElementById('optimizedDescription') as HTMLTextAreaElement | null)?.value || '';
    const description = descriptionRaw.replace(/"/g, '""');
    const price = (document.getElementById('productPrice') as HTMLInputElement | null)?.value || '';
    const currency = (document.getElementById('productCurrency') as HTMLSelectElement | null)?.value || 'USD';
    
    return `"Title","Description","Price","Currency"
"${title}","${description}","${price}","${currency}"`;
  }

  function copyOptimizedContent(): void {
    const title = (document.getElementById('optimizedTitle') as HTMLInputElement | null)?.value || '';
    const description = (document.getElementById('optimizedDescription') as HTMLTextAreaElement | null)?.value || '';
    const price = (document.getElementById('productPrice') as HTMLInputElement | null)?.value || '';
    const currency = (document.getElementById('productCurrency') as HTMLSelectElement | null)?.value || 'USD';
    const content = `Title: ${title}
Description: ${description}
Price: ${price} ${currency}`;
    
    navigator.clipboard.writeText(content).then(() => {
      alert('Optimized content copied to clipboard!');
    }).catch(() => {/* noop */});
  }

  function generateReport(): string {
    return `<!DOCTYPE html>
<html>
<head>
    <title>E-commerce Optimization Report</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .score { background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .recommendations { background: #fef3c7; padding: 15px; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>E-commerce Optimization Report</h1>
    <div class="score">
        <h2>Optimization Scores</h2>
        <p>SEO Score: 75/100</p>
        <p>Conversion Score: 68/100</p>
        <p>Mobile Score: 82/100</p>
    </div>
    <div class="recommendations">
        <h2>Key Recommendations</h2>
        <ul>
            <li>Add structured data markup for better search visibility</li>
            <li>Optimize product images with descriptive alt text</li>
            <li>Include customer reviews and ratings</li>
            <li>Add clear call-to-action buttons</li>
        </ul>
    </div>
</body>
</html>`;
  }

  document.getElementById('backStep5')?.addEventListener('click', () => showStep(4));
  document.getElementById('restartProcess')?.addEventListener('click', () => {
    // Reset form
    document.querySelectorAll('input, textarea, select').forEach((el) => {
      const tag = (el as HTMLElement).tagName;
      if (tag === 'INPUT') {
        const i = el as HTMLInputElement;
        if (i.type === 'file') i.value = '';
        else i.value = '';
      } else if (tag === 'SELECT') {
        const s = el as HTMLSelectElement;
        s.selectedIndex = 0;
      } else if (tag === 'TEXTAREA') {
        const t = el as HTMLTextAreaElement;
        t.value = '';
      }
    });
    showStep(1);
  });

  // Initialize
  showStep(1);
</script>
</Layout>