---
import Layout from '../../layouts/Layout.astro';
import Nav from '../../components/Nav.astro';
---
<Layout>
  <Nav/>
  <main class="mn">
    <header class="hd">
      <div class="hd-tx">
        <h1 class="tl">Bulk Content Generator Results</h1>
        <p class="st">Your AI-generated articles are ready. Review, edit, and export them below.</p>
      </div>
    </header>

    <div id="resultsContainer" class="rs-gd"></div>

    <div class="bt-gr">
      <a href="/bulk-generator/" class="bt-bk"><span class="bt-ar">‚Üê</span><span>Back to Input</span></a>
      <button class="bt-pr" id="exportAll"><span>Export All</span><span class="bt-ar">üì•</span></button>
    </div>
  </main>

  <script>
    interface BulkItem { keyword: string; title: string }

    const fallbackItems: BulkItem[] = [
      { keyword: 'wireless headphones', title: 'The Ultimate Guide to Wireless Headphones in 2025' },
      { keyword: 'ai content tools', title: 'Top AI Content Tools Every Marketer Should Know' },
      { keyword: 'seo basics', title: 'SEO Basics: A Beginners Roadmap to Ranking' },
      { keyword: 'content calendar', title: 'Building a Content Calendar that Actually Works' },
      { keyword: 'email marketing', title: 'Email Marketing Strategies to Boost Engagement' },
      { keyword: 'voice search', title: 'Optimizing for Voice Search: Practical Tips' },
      { keyword: 'topic clusters', title: 'How Topic Clusters Improve Your SEO Strategy' },
      { keyword: 'schema markup', title: 'Schema Markup Explained for Non-Developers' },
      { keyword: 'internal linking', title: 'Internal Linking Strategies for Growth' },
      { keyword: 'core web vitals', title: 'Core Web Vitals: Your Actionable Checklist' }
    ];

    function readItemsFromUrl(): BulkItem[] {
      try {
        const params = new URLSearchParams(window.location.search);
        const dataParam = params.get('data');
        if (dataParam) {
          const json = atob(decodeURIComponent(dataParam));
          const arr = JSON.parse(json) as BulkItem[];
          if (Array.isArray(arr) && arr.length > 0) {
            return arr.slice(0, 10);
          }
        }
      } catch (_) {}
      try {
        const stored = localStorage.getItem('bulkData');
        if (stored) {
          const arr = JSON.parse(stored) as BulkItem[];
          if (Array.isArray(arr) && arr.length > 0) {
            return arr.slice(0, 10);
          }
        }
      } catch (_) {}
      return fallbackItems;
    }

    function generateContentForItem(item: BulkItem): string {
      const intro = `In this article, we explore ${item.keyword} and share practical strategies to help you make informed decisions. ${item.title} covers essentials, best practices, and tips to implement right away.`;
      const outline = [
        'Introduction and Context',
        'Key Benefits and Use Cases',
        'Implementation Steps and Best Practices',
        'Common Pitfalls and How to Avoid Them',
        'Conclusion and Next Steps'
      ];
      const body = [
        `Understanding ${item.keyword} is crucial for modern marketers and product teams. Start by defining clear objectives and identifying metrics that reflect real outcomes.`,
        `When applying ${item.keyword}, focus on audience needs and measurable impact. Align tactics with a clear content strategy to avoid ad‚Äëhoc execution.`,
        `For implementation, establish a simple checklist and iterate weekly. Small improvements in ${item.keyword} often compound into sustainable gains.`,
        `Avoid common mistakes like over‚Äëoptimizing for vanity metrics. Instead, prioritize clarity, utility, and user satisfaction.`,
      ];
      const conclusion = `By approaching ${item.keyword} with a structured plan, you can turn insights into outcomes. Use the outline above as a repeatable framework.`;

      return [
        `# ${item.title}`,
        `\n**Primary Keyword:** ${item.keyword}`,
        `\n${intro}`,
        `\n## Outline`,
        ...outline.map(o => `- ${o}`),
        `\n## Body`,
        ...body.map(p => `\n${p}`),
        `\n## Conclusion`,
        conclusion
      ].join('\n');
    }

    function renderResults(items: BulkItem[]): void {
      const container = document.getElementById('resultsContainer') as HTMLElement | null;
      if (!container) return;
      container.innerHTML = '';
      items.forEach((it, index) => {
        const card = document.createElement('div');
        card.className = 'bc-it';
        const content = generateContentForItem(it);
        
        // Format content to better match the reference image
        const formattedContent = content
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/\n## ([^\n]+)/g, '<h2>$1</h2>')
          .replace(/\n# ([^\n]+)/g, '<h1>$1</h1>')
          .replace(/\n\*\*([^\*]+)\*\*/g, '<p><strong>$1</strong></p>')
          .replace(/\n- ([^\n]+)/g, '<li>$1</li>')
          .replace(/(<li>.*<\/li>)+/g, '<ul>$&</ul>')
          .replace(/\n([^\n<]+)/g, '<p>$1</p>');
        
        card.innerHTML = `
          <div class="bc-hd">
            <div class="bc-tl">${it.title}</div>
            <div class="bc-kw">Keyword: <span>${it.keyword}</span></div>
          </div>
          <div class="bc-ct">${formattedContent}</div>
          <div class="bc-ft">
            <button class="bt-ac" onclick="editArticle(${index})">Edit</button>
            <button class="bt-ac" onclick="copyArticle(${index})">Copy</button>
            <button class="bt-ac" onclick="downloadArticle(${index})">Download</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    let currentItems: BulkItem[] = [];

    function editArticle(idx: number): void {
      alert('Edit functionality coming soon!');
    }

    function copyArticle(idx: number): void {
      const it = currentItems[idx];
      if(!it) return;
      const content = generateContentForItem(it);
      navigator.clipboard.writeText(content).then(()=>{
        alert('Article copied to clipboard!');
      }).catch(()=>{
        alert('Failed to copy to clipboard');
      });
    }

    function downloadArticle(idx: number): void {
      const it = currentItems[idx];
      if(!it) return;
      const content = generateContentForItem(it);
      const blob = new Blob([content], {type: 'text/markdown'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${it.keyword.replace(/\s+/g,'-')}.md`;
      a.click();
      URL.revokeObjectURL(url);
    }

    const exportAllBtn = document.getElementById('exportAll');
    exportAllBtn?.addEventListener('click', ()=>{
      if(currentItems.length===0) return;
      let allContent = '';
      currentItems.forEach(it=>{
        allContent += generateContentForItem(it) + '\n\n---\n\n';
      });
      const blob = new Blob([allContent], {type: 'text/markdown'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'bulk-content-export.md';
      a.click();
      URL.revokeObjectURL(url);
    });

    const items = readItemsFromUrl();
    currentItems = items;
    renderResults(items);
  </script>

  <style>
    .mn{margin-left:240px;padding:48px;min-height:100vh;max-width:1400px;margin-right:auto;background:#f8fafc;animation:sf .4s ease}
    .hd{margin-bottom:48px}
    .hd-tx{text-align:center}
    .tl{font-size:42px;font-weight:800;color:#1a202c;margin:0 0 12px 0;line-height:1.2}
    .st{font-size:18px;color:#64748b;margin:0}
    .rs-gd{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:28px;margin-bottom:40px}
    .bc-it{background:#fff;border:2px solid #e5e7eb;border-radius:16px;padding:0;box-shadow:0 2px 8px rgba(0,0,0,.06);transition:all .3s ease;display:flex;flex-direction:column;overflow:hidden}
    .bc-it:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.12);border-color:#cbd5e1}
    .bc-hd{padding:20px 24px;border-bottom:2px solid #f3f4f6;background:linear-gradient(135deg,#fafbfc 0%,#fff 100%)}
    .bc-tl{font-size:18px;font-weight:700;color:#1a202c;margin:0 0 8px 0;line-height:1.4}
    .bc-kw{font-size:13px;color:#64748b;font-weight:500}
    .bc-kw span{color:#10b981;font-weight:600}
    .bc-ct{padding:24px;font-size:14px;color:#4b5563;line-height:1.7;flex:1;overflow:auto;max-height:400px}
    .bc-ct h1{font-size:20px;font-weight:700;color:#1a202c;margin:0 0 12px 0}
    .bc-ct h2{font-size:17px;font-weight:700;color:#1a202c;margin:20px 0 10px 0}
    .bc-ct h3{font-size:15px;font-weight:600;color:#374151;margin:16px 0 8px 0}
    .bc-ct p{margin:0 0 12px 0}
    .bc-ct ul{padding-left:20px;margin:8px 0}
    .bc-ct li{margin-bottom:6px}
    .bc-ct strong{color:#1a202c;font-weight:600}
    .bc-ft{padding:16px 24px;border-top:2px solid #f3f4f6;display:flex;gap:10px;background:#fafbfc}
    .bt-ac{background:#fff;border:2px solid #e5e7eb;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:600;color:#374151;cursor:pointer;transition:all .2s}
    .bt-ac:hover{background:#f3f4f6;border-color:#cbd5e1;transform:translateY(-1px)}
    .bt-gr{display:flex;gap:14px;justify-content:center;margin-top:20px}
    .bt-bk{display:inline-flex;align-items:center;gap:8px;background:#fff;border:2px solid #e5e7eb;border-radius:10px;padding:13px 24px;font-size:14px;font-weight:600;color:#374151;text-decoration:none;transition:all .25s}
    .bt-bk:hover{background:#f3f4f6;border-color:#cbd5e1;transform:translateY(-2px)}
    .bt-pr{display:inline-flex;align-items:center;gap:8px;background:#10b981;border:none;border-radius:10px;padding:13px 24px;font-size:14px;font-weight:600;color:#fff;cursor:pointer;transition:all .25s}
    .bt-pr:hover{background:#059669;transform:translateY(-2px);box-shadow:0 4px 12px rgba(16,185,129,.3)}
    .bt-ar{font-weight:700}
    @keyframes sf{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @media(max-width:1024px){.mn{margin-left:72px;padding:32px}.rs-gd{grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}}
    @media(max-width:640px){.mn{margin-left:0;padding:20px;padding-bottom:80px}.tl{font-size:28px}.st{font-size:15px}.rs-gd{grid-template-columns:1fr;gap:16px}.bc-hd{padding:16px 20px}.bc-ct{padding:20px;max-height:300px}.bc-ft{padding:12px 20px;flex-wrap:wrap}.bt-ac{padding:6px 12px;font-size:12px}.bt-gr{flex-direction:column;gap:10px}.bt-bk,.bt-pr{padding:11px 18px;font-size:13px;justify-content:center}}</style>
</Layout>