---
import Layout from '../../layouts/Layout.astro';
import Nav from '../../components/Nav.astro';
---
<Layout>
  <Nav/>
  <main class="mn">
    <div class="pg-hd">
      <div class="hd-ic">ðŸ§°</div>
      <h1 class="tl">Bulk Content Generator â€“ Step 1</h1>
      <p class="st">Enter titles and keywords in a table, then generate.</p>
    </div>

    <div class="bg-wr">
      <div class="bg-in">
        <div class="tb-hd">
          <span>Input Table</span>
          <span class="tb-ht">10 rows prefilled for showcasing</span>
        </div>
        <table class="fm-tb" id="inputTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Keyword</th>
              <th>Title</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
        <button id="generateBulk" class="bt-gn"><span class="gn-ic">âœ¨</span><span>Generate</span></button>
      </div>
    </div>
  </main>

  <script>
    interface BulkItem { keyword: string; title: string }

    const sampleItems: BulkItem[] = [
      { keyword: 'wireless headphones', title: 'The Ultimate Guide to Wireless Headphones in 2025' },
      { keyword: 'ai content tools', title: 'Top AI Content Tools Every Marketer Should Know' },
      { keyword: 'seo basics', title: 'SEO Basics: A Beginnerâ€™s Roadmap to Ranking' },
      { keyword: 'content calendar', title: 'Building a Content Calendar that Actually Works' },
      { keyword: 'email marketing', title: 'Email Marketing Strategies to Boost Engagement' },
      { keyword: 'voice search', title: 'Optimizing for Voice Search: Practical Tips' },
      { keyword: 'topic clusters', title: 'How Topic Clusters Improve Your SEO Strategy' },
      { keyword: 'schema markup', title: 'Schema Markup Explained for Non-Developers' },
      { keyword: 'internal linking', title: 'Internal Linking Strategies for Growth' },
      { keyword: 'core web vitals', title: 'Core Web Vitals: Your Actionable Checklist' }
    ];

    const tableBody = document.getElementById('tableBody') as HTMLElement | null;
    const generateBtn = document.getElementById('generateBulk') as HTMLButtonElement | null;

    function renderRows(items: BulkItem[]): void {
      if (!tableBody) return;
      tableBody.innerHTML = '';
      items.forEach((it, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="idx">${idx + 1}</td>
          <td><input type="text" class="fm-in" id="kw-${idx}" value="${it.keyword}"/></td>
          <td><input type="text" class="fm-in" id="tl-${idx}" value="${it.title}"/></td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function collectItems(): BulkItem[] {
      const items: BulkItem[] = [];
      for (let i = 0; i < 10; i++) {
        const kwEl = document.getElementById(`kw-${i}`) as HTMLInputElement | null;
        const tlEl = document.getElementById(`tl-${i}`) as HTMLInputElement | null;
        const keyword = kwEl?.value?.trim() || '';
        const title = tlEl?.value?.trim() || '';
        if (keyword && title) items.push({ keyword, title });
      }
      return items;
    }

    function navigateToResults(items: BulkItem[]): void {
      if (items.length === 0) {
        alert('Please provide at least one row with keyword and title');
        return;
      }
      try {
        const json = JSON.stringify(items);
        const data = encodeURIComponent(btoa(json));
        window.location.href = `/bulk-generator/results?data=${data}`;
      } catch (_) {
        // Fallback to localStorage if encoding fails
        try {
          localStorage.setItem('bulkData', JSON.stringify(items));
          window.location.href = `/bulk-generator/results`;
        } catch {}
      }
    }

    renderRows(sampleItems);
    generateBtn?.addEventListener('click', () => {
      const items = collectItems();
      navigateToResults(items);
    });
  </script>

  <style>
    .mn{margin-left:240px;padding:24px;min-height:100vh;background:#f8fafc}
    .pg-hd{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .hd-ic{font-size:24px}
    .tl{font-size:26px;font-weight:800;color:#111827;margin:0}
    .st{color:#6b7280;margin:0}
    .bg-wr{display:grid;grid-template-columns:1fr;gap:24px}
    .bg-in{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .tb-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .tb-ht{color:#6b7280;font-size:13px}
    .fm-tb{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    .fm-tb th,.fm-tb td{border-bottom:1px solid #e5e7eb;padding:10px;text-align:left}
    .fm-tb thead th{background:#f9fafb;font-weight:700;color:#374151}
    .fm-tb tbody tr:last-child td{border-bottom:none}
    .fm-in{width:100%;border:1px solid #d1d5db;border-radius:8px;padding:8px;font-size:14px}
    .idx{color:#6b7280;width:40px}
    .bt-gn{display:inline-flex;align-items:center;gap:8px;background:#10b981;color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;margin-top:12px}
    .gn-ic{filter:drop-shadow(0 1px 2px rgba(16,185,129,.4))}
  </style>
</Layout>